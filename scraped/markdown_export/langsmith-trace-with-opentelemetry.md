# langsmith-trace-with-opentelemetry

> Source: https://docs.langchain.com/langsmith/trace-with-opentelemetry

LangSmith supports OpenTelemetry-based tracing, allowing you to send traces from any OpenTelemetry-compatible application. This guide covers both automatic instrumentation for LangChain applications and manual instrumentation for other frameworks.
Learn how to trace your LLM applications using OpenTelemetry with LangSmith.
Update the LangSmith URL appropriately for self-hosted installations or organizations in the EU region in the requests below. For the EU region, use eu.api.smith.langchain.com
.
Trace a LangChain application
If you’re using LangChain or LangGraph, use the built-in integration to trace your application:
-
Install the LangSmith package with OpenTelemetry support:
Requires Python SDK version langsmith>=0.3.18
. We recommend langsmith>=0.4.25
to benefit from important OpenTelemetry fixes.
-
In your LangChain/LangGraph App, enable the OpenTelemetry integration by setting the
LANGSMITH_OTEL_ENABLED
environment variable:
-
Create a LangChain application with tracing. For example:
-
View the traces in your LangSmith dashboard (example) once your application runs.
Trace a non-LangChain application
For non-LangChain applications or custom instrumentation, you can trace your application in LangSmith with a standard OpenTelemetry client. (We recommend langsmith ≥ 0.4.25.)
-
Install the OpenTelemetry SDK, OpenTelemetry exporter packages, as well as the OpenAI package:
-
Setup environment variables for the endpoint, substitute your specific values:
Depending on how your otel exporter is configured, you may need to append /v1/traces
to the endpoint if you are only sending traces.
If you’re self-hosting LangSmith, replace the base endpoint with your LangSmith api endpoint and append /api/v1
. For example: OTEL_EXPORTER_OTLP_ENDPOINT=https://ai-company.com/api/v1/otel
Optional: Specify a custom project name other than “default”:
-
Log a trace.
This code sets up an OTEL tracer and exporter that will send traces to LangSmith. It then calls OpenAI and sends the required OpenTelemetry attributes.
-
View the trace in your LangSmith dashboard (example).
Send traces to an alternate provider
While LangSmith is the default destination for OpenTelemetry traces, you can also configure OpenTelemetry to send traces to other observability platforms.
Available in LangSmith Python SDK ≥ 0.4.1. We recommend ≥ 0.4.25 for fixes that improve OTEL export and hybrid fan-out stability.
Use environment variables for global configuration
By default, the LangSmith OpenTelemetry exporter will send data to the LangSmith API OTEL endpoint, but this can be customized by setting standard OTEL environment variables:
LangSmith uses the HTTP trace exporter by default. If you’d like to use your own tracing provider, you can either:
- Set the OTEL environment variables as shown above, or
- Set a global trace provider before initializing LangChain components, which LangSmith will detect and use instead of creating its own.
To send traces to a different provider, configure the OTLP exporter with your provider’s endpoint:
Hybrid tracing is available in version ≥ 0.4.1. To send traces only to your OTEL endpoint, set:LANGSMITH_OTEL_ONLY="true"
(Recommendation: use langsmith ≥ 0.4.25.)
Supported OpenTelemetry attribute and event mapping
When sending traces to LangSmith via OpenTelemetry, the following attributes are mapped to LangSmith fields:
Core LangSmith attributes
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
langsmith.trace.name | Run name | Overrides the span name for the run |
langsmith.span.kind | Run type | Values: llm , chain , tool , retriever , embedding , prompt , parser |
langsmith.trace.session_id | Session ID | Session identifier for related traces |
langsmith.trace.session_name | Session name | Name of the session |
langsmith.span.tags | Tags | Custom tags attached to the span (comma-separated) |
langsmith.metadata.{key} | metadata.{key} | Custom metadata with langsmith prefix |
GenAI standard attributes
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
gen_ai.system | metadata.ls_provider | The GenAI system (e.g., “openai”, “anthropic”) |
gen_ai.operation.name | Run type | Maps “chat”/“completion” to “llm”, “embedding” to “embedding” |
gen_ai.prompt | inputs | The input prompt sent to the model |
gen_ai.completion | outputs | The output generated by the model |
gen_ai.prompt.{n}.role | inputs.messages[n].role | Role for the nth input message |
gen_ai.prompt.{n}.content | inputs.messages[n].content | Content for the nth input message |
gen_ai.prompt.{n}.message.role | inputs.messages[n].role | Alternative format for role |
gen_ai.prompt.{n}.message.content | inputs.messages[n].content | Alternative format for content |
gen_ai.completion.{n}.role | outputs.messages[n].role | Role for the nth output message |
gen_ai.completion.{n}.content | outputs.messages[n].content | Content for the nth output message |
gen_ai.completion.{n}.message.role | outputs.messages[n].role | Alternative format for role |
gen_ai.completion.{n}.message.content | outputs.messages[n].content | Alternative format for content |
gen_ai.input.messages | inputs.messages | Array of input messages |
gen_ai.output.messages | outputs.messages | Array of output messages |
gen_ai.tool.name | invocation_params.tool_name | Tool name, also sets run type to “tool” |
GenAI request parameters
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
gen_ai.request.model | invocation_params.model | The model name used for the request |
gen_ai.response.model | invocation_params.model | The model name returned in the response |
gen_ai.request.temperature | invocation_params.temperature | Temperature setting |
gen_ai.request.top_p | invocation_params.top_p | Top-p sampling setting |
gen_ai.request.max_tokens | invocation_params.max_tokens | Maximum tokens setting |
gen_ai.request.frequency_penalty | invocation_params.frequency_penalty | Frequency penalty setting |
gen_ai.request.presence_penalty | invocation_params.presence_penalty | Presence penalty setting |
gen_ai.request.seed | invocation_params.seed | Random seed used for generation |
gen_ai.request.stop_sequences | invocation_params.stop | Sequences that stop generation |
gen_ai.request.top_k | invocation_params.top_k | Top-k sampling parameter |
gen_ai.request.encoding_formats | invocation_params.encoding_formats | Output encoding formats |
GenAI usage metrics
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
gen_ai.usage.input_tokens | usage_metadata.input_tokens | Number of input tokens used |
gen_ai.usage.output_tokens | usage_metadata.output_tokens | Number of output tokens used |
gen_ai.usage.total_tokens | usage_metadata.total_tokens | Total number of tokens used |
gen_ai.usage.prompt_tokens | usage_metadata.input_tokens | Number of input tokens used (deprecated) |
gen_ai.usage.completion_tokens | usage_metadata.output_tokens | Number of output tokens used (deprecated) |
gen_ai.usage.details.reasoning_tokens | usage_metadata.reasoning_tokens | Number of reasoning tokens used |
TraceLoop attributes
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
traceloop.entity.input | inputs | Full input value from TraceLoop |
traceloop.entity.output | outputs | Full output value from TraceLoop |
traceloop.entity.name | Run name | Entity name from TraceLoop |
traceloop.span.kind | Run type | Maps to LangSmith run types |
traceloop.llm.request.type | Run type | ”embedding” maps to “embedding”, others to “llm” |
traceloop.association.properties.{key} | metadata.{key} | Custom metadata with traceloop prefix |
OpenInference attributes
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
input.value | inputs | Full input value, can be string or JSON |
output.value | outputs | Full output value, can be string or JSON |
openinference.span.kind | Run type | Maps various kinds to LangSmith run types |
llm.system | metadata.ls_provider | LLM system provider |
llm.model_name | metadata.ls_model_name | Model name from OpenInference |
tool.name | Run name | Tool name when span kind is “TOOL” |
metadata | metadata.* | JSON string of metadata to be merged |
LLM attributes
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
llm.input_messages | inputs.messages | Input messages |
llm.output_messages | outputs.messages | Output messages |
llm.token_count.prompt | usage_metadata.input_tokens | Prompt token count |
llm.token_count.completion | usage_metadata.output_tokens | Completion token count |
llm.token_count.total | usage_metadata.total_tokens | Total token count |
llm.usage.total_tokens | usage_metadata.total_tokens | Alternative total token count |
llm.invocation_parameters | invocation_params.* | JSON string of invocation parameters |
llm.presence_penalty | invocation_params.presence_penalty | Presence penalty |
llm.frequency_penalty | invocation_params.frequency_penalty | Frequency penalty |
llm.request.functions | invocation_params.functions | Function definitions |
Prompt template attributes
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
llm.prompt_template.variables | Run type | Sets run type to “prompt”, used with input.value |
Retriever attributes
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
retrieval.documents.{n}.document.content | outputs.documents[n].page_content | Content of the nth retrieved document |
retrieval.documents.{n}.document.metadata | outputs.documents[n].metadata | Metadata of the nth retrieved document (JSON) |
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
tools | invocation_params.tools | Array of tool definitions |
tool_arguments | invocation_params.tool_arguments | Tool arguments as JSON or key-value pairs |
Logfire attributes
| OpenTelemetry attribute | LangSmith field | Notes |
|---|
prompt | inputs | Logfire prompt input |
all_messages_events | outputs | Logfire message events output |
events | inputs /outputs | Logfire events array, splits input/choice events |
OpenTelemetry event mapping
| Event name | LangSmith field | Notes |
|---|
gen_ai.content.prompt | inputs | Extracts prompt content from event attributes |
gen_ai.content.completion | outputs | Extracts completion content from event attributes |
gen_ai.system.message | inputs.messages[] | System message in conversation |
gen_ai.user.message | inputs.messages[] | User message in conversation |
gen_ai.assistant.message | outputs.messages[] | Assistant message in conversation |
gen_ai.tool.message | outputs.messages[] | Tool response message |
gen_ai.choice | outputs | Model choice/response with finish reason |
exception | status , error | Sets status to “error” and extracts exception message/stacktrace |
For message events, the following attributes are extracted:
content
→ message content
role
→ message role
id
→ tool_call_id (for tool messages)
gen_ai.event.content
→ full message JSON
For choice events:
finish_reason
→ choice finish reason
message.content
→ choice message content
message.role
→ choice message role
tool_calls.{n}.id
→ tool call ID
tool_calls.{n}.function.name
→ tool function name
tool_calls.{n}.function.arguments
→ tool function arguments
tool_calls.{n}.type
→ tool call type
For exception events:
exception.message
→ error message
exception.stacktrace
→ error stacktrace (appended to message)
Implementation examples
Trace using the LangSmith SDK
Use the LangSmith SDK’s OpenTelemetry helper to configure export:
You do not need to set OTEL environment variables or exporters. configure()
wires them for LangSmith automatically; instrumentors (like GoogleADKInstrumentor
) create the spans.
- View the trace in your LangSmith dashboard (example).
Advanced configuration
Use OpenTelemetry Collector for fan-out
For more advanced scenarios, you can use the OpenTelemetry Collector to fan out your telemetry data to multiple destinations. This is a more scalable approach than configuring multiple exporters in your application code.
-
Install the OpenTelemetry Collector for your environment.
-
Create a configuration file (e.g.,
otel-collector-config.yaml
) that exports to multiple destinations:
-
Configure your application to send to the collector:
This approach offers several advantages:
- Centralized configuration for all your telemetry destinations
- Reduced overhead in your application code
- Better scalability and resilience
- Ability to add or remove destinations without changing application code
Distributed tracing with LangChain and OpenTelemetry
Distributed tracing is essential when your LLM application spans multiple services or processes. OpenTelemetry’s context propagation capabilities ensure that traces remain connected across service boundaries.
Context propagation in distributed tracing
In distributed systems, context propagation passes trace metadata between services so that related spans are linked to the same trace:
- Trace ID: A unique identifier for the entire trace
- Span ID: A unique identifier for the current span
- Sampling Decision: Indicates whether this trace should be sampled
Set up distributed tracing with LangChain
To enable distributed tracing across multiple services: